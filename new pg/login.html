<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ - ê²Œì„ í¬í„¸</title>
    <link rel="stylesheet" href="styles.css">
    <script src="common-auth.js"></script>
</head>
<body>
    <!-- í—¤ë” ë„¤ë¹„ê²Œì´ì…˜ -->
    <header class="header">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">ğŸ®</span>
                <span class="logo-text">GAME PORTAL</span>
            </a>
            
            <nav class="nav">
                <ul class="nav-menu" id="navMenu">
                    <li class="nav-item">
                        <a href="game-info.html" class="nav-link">ê²Œì„ì •ë³´</a>
                    </li>
                    <li class="nav-item">
                        <a href="gacha-shop.html" class="nav-link">ê°“ì± ìƒµ</a>
                    </li>
                    <li class="nav-item">
                        <a href="community.html" class="nav-link">ì»¤ë®¤ë‹ˆí‹°</a>
                    </li>
                    <li class="nav-item">
                        <a href="media.html" class="nav-link">ë¯¸ë””ì–´</a>
                    </li>
                    <li class="nav-item">
                        <a href="customer-service.html" class="nav-link">ê³ ê°ì„¼í„°</a>
                    </li>
                </ul>
            </nav>

            <div class="auth-buttons">
                <!-- common-auth.jsì—ì„œ ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨ -->
            </div>

            <button class="mobile-menu-toggle" id="mobileToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main">
        <!-- ì¸ì¦ ì„¹ì…˜ -->
        <section class="auth-section">
            <div class="auth-container">
                <div class="auth-card">
                    <div class="auth-header">
                        <h1 class="auth-title">ë¡œê·¸ì¸</h1>
                        <p class="auth-subtitle">ê²Œì„ í¬í„¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</p>
                    </div>

                    <form class="auth-form" id="loginForm">
                        <div class="form-group">
                            <label class="form-label" for="email">ì´ë©”ì¼</label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email"
                                class="form-input" 
                                placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                required
                            >
                            <span class="form-error" id="emailError"></span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="password">ë¹„ë°€ë²ˆí˜¸</label>
                            <div class="password-field">
                                <input 
                                    type="password" 
                                    id="password" 
                                    name="password"
                                    class="form-input" 
                                    placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                    required
                                >
                                <button type="button" class="password-toggle" id="passwordToggle">
                                    â—‰
                                </button>
                            </div>
                            <span class="form-error" id="passwordError"></span>
                        </div>

                        <div class="form-options">
                            <label class="checkbox-container">
                                <input type="checkbox" id="rememberMe">
                                <span class="checkmark"></span>
                                ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€
                            </label>
                            <a href="forgot-password.html" class="forgot-password">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
                        </div>

                        <button type="submit" class="auth-submit-btn" id="loginBtn">
                            <span class="btn-text">ë¡œê·¸ì¸</span>
                            <div class="btn-loading" id="loginLoading">
                                <div class="loading-spinner"></div>
                            </div>
                        </button>

                        <div class="form-divider">
                            <span>ë˜ëŠ”</span>
                        </div>

                        <div class="social-login">
                            <button type="button" class="social-btn google-btn" id="googleLogin">
                                <span class="social-icon">ğŸŒ</span>
                                Googleë¡œ ë¡œê·¸ì¸
                            </button>
                            <button type="button" class="social-btn kakao-btn" id="kakaoLogin">
                                <span class="social-icon">ğŸ’¬</span>
                                ì¹´ì¹´ì˜¤ë¡œ ë¡œê·¸ì¸
                            </button>
                        </div>

                        <div class="auth-switch">
                            <p>ì•„ì§ ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="signup.html">íšŒì›ê°€ì…</a></p>
                        </div>
                    </form>
                </div>

                <!-- ë¡œê·¸ì¸ í˜œíƒ ì„¹ì…˜ -->
                <div class="auth-benefits">
                    <h3>ë¡œê·¸ì¸ í˜œíƒ</h3>
                    <div class="benefits-list">
                        <div class="benefit-item">
                            <div class="benefit-icon">ğŸ</div>
                            <div class="benefit-content">
                                <h4>ë§¤ì¼ ë¡œê·¸ì¸ ë³´ìƒ</h4>
                                <p>ë§¤ì¼ ì ‘ì†í•˜ë©´ ë‹¤ì´ì•„ëª¬ë“œì™€ ê³¨ë“œë¥¼ ë“œë ¤ìš”!</p>
                            </div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">ğŸ’¾</div>
                            <div class="benefit-content">
                                <h4>ê²Œì„ ì§„í–‰ìƒí™© ì €ì¥</h4>
                                <p>ì–¸ì œ ì–´ë””ì„œë“  ê²Œì„ì„ ì´ì–´ì„œ í”Œë ˆì´í•˜ì„¸ìš”</p>
                            </div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">ğŸ‘¥</div>
                            <div class="benefit-content">
                                <h4>ì¹œêµ¬ì™€ í•¨ê»˜</h4>
                                <p>ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ë ˆì´ë“œì™€ ê¸¸ë“œ í™œë™ì„ ì¦ê¸°ì„¸ìš”</p>
                            </div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">ğŸ†</div>
                            <div class="benefit-content">
                                <h4>ë­í‚¹ ì‹œìŠ¤í…œ</h4>
                                <p>ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ê³¼ ì‹¤ë ¥ì„ ê²¨ë¤„ë³´ì„¸ìš”</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>ê²Œì„ í¬í„¸</h4>
                    <p>ìµœê³ ì˜ ê²Œì„ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤</p>
                </div>
                <div class="footer-section">
                    <h4>ì§€ì›</h4>
                    <a href="#">FAQ</a>
                    <a href="customer-service.html">ê³ ê°ì„¼í„°</a>
                    <a href="#">ë²„ê·¸ ì‹ ê³ </a>
                </div>
                <div class="footer-section">
                    <h4>ì»¤ë®¤ë‹ˆí‹°</h4>
                    <a href="community.html">ê³µì‹ í¬ëŸ¼</a>
                    <a href="#">ë””ìŠ¤ì½”ë“œ</a>
                    <a href="#">ìœ íŠœë¸Œ</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Game Portal. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€
        const mobileToggle = document.getElementById('mobileToggle');
        const navMenu = document.getElementById('navMenu');

        mobileToggle.addEventListener('click', function() {
            this.classList.toggle('active');
            navMenu.classList.toggle('active');
        });

        // ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°/ìˆ¨ê¸°ê¸°
        const passwordToggle = document.getElementById('passwordToggle');
        const passwordField = document.getElementById('password');

        passwordToggle.addEventListener('click', function() {
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            this.textContent = type === 'password' ? 'â—‰' : 'â—';
        });

        // í¼ ìœ íš¨ì„± ê²€ì‚¬
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function showError(fieldId, message) {
            const errorElement = document.getElementById(fieldId + 'Error');
            const inputElement = document.getElementById(fieldId);
            errorElement.textContent = message;
            inputElement.classList.add('error');
        }

        function clearError(fieldId) {
            const errorElement = document.getElementById(fieldId + 'Error');
            const inputElement = document.getElementById(fieldId);
            errorElement.textContent = '';
            inputElement.classList.remove('error');
        }

        // ë¡œê·¸ì¸ í¼ ì œì¶œ
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const loginLoading = document.getElementById('loginLoading');

        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // ì—ëŸ¬ ì´ˆê¸°í™”
            clearError('email');
            clearError('password');

            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;

            let isValid = true;

            // ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬
            if (!email) {
                showError('email', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            } else if (!validateEmail(email)) {
                showError('email', 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            }

            // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
            if (!password) {
                showError('password', 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            } else if (password.length < 4) {
                showError('password', 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                isValid = false;
            }

            if (!isValid) return;

            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            loginBtn.disabled = true;
            loginLoading.style.display = 'block';

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    // ë¡œê·¸ì¸ ì„±ê³µ
                    if (rememberMe) {
                        localStorage.setItem('rememberUser', email);
                    }
                    
                    // common-auth.jsì˜ í•¨ìˆ˜ ì‚¬ìš©
                    onLoginSuccess(result.user);
                } else {
                    // ë¡œê·¸ì¸ ì‹¤íŒ¨
                    if (result.error === 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤') {
                        showError('email', result.error);
                    } else if (result.error === 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤') {
                        showError('password', result.error);
                    } else {
                        alert(result.error || 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                AuthUtils.handleNetworkError(error);
            } finally {
                // ë¡œë”© ìƒíƒœ í•´ì œ
                loginBtn.disabled = false;
                loginLoading.style.display = 'none';
            }
        });

        // ì†Œì…œ ë¡œê·¸ì¸
        document.getElementById('googleLogin').addEventListener('click', function() {
            alert('Google ë¡œê·¸ì¸ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        });

        document.getElementById('kakaoLogin').addEventListener('click', function() {
            alert('ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // ê¸°ì–µëœ ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
            const rememberedUser = localStorage.getItem('rememberUser');
            if (rememberedUser) {
                document.getElementById('email').value = rememberedUser;
                document.getElementById('rememberMe').checked = true;
            }

            // ìŠ¤í¬ë¡¤ íš¨ê³¼
            window.addEventListener('scroll', function() {
                const header = document.querySelector('.header');
                if (window.scrollY > 100) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });

            // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ì—ëŸ¬ ì œê±°
            document.getElementById('email').addEventListener('focus', () => clearError('email'));
            document.getElementById('password').addEventListener('focus', () => clearError('password'));
        });
    </script>
</body>
</html>