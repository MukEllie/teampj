<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì… - ê²Œì„ í¬í„¸</title>
    <link rel="stylesheet" href="styles.css">
    <script src="common-auth.js"></script>
    <style>
        /* ì¤‘ë³µì²´í¬ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .input-with-button {
            display: flex;
            gap: 0.5rem;
            align-items: flex-start;
        }
        
        .input-with-button .form-input {
            flex: 1;
        }
        
        .check-btn {
            padding: 0.8rem 1rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .check-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }
        
        .check-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .form-success {
            color: #28a745;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            display: block;
        }
        
        .form-error.success {
            color: #28a745;
        }
        
        .form-input.success {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40,167,69,0.1);
        }
    </style>
</head>
<body>
    <!-- í—¤ë” ë„¤ë¹„ê²Œì´ì…˜ -->
    <header class="header">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">ğŸ®</span>
                <span class="logo-text">GAME PORTAL</span>
            </a>
            
            <nav class="nav">
                <ul class="nav-menu" id="navMenu">
                    <li class="nav-item">
                        <a href="game-info.html" class="nav-link">ê²Œì„ì •ë³´</a>
                    </li>
                    <li class="nav-item">
                        <a href="gacha-shop.html" class="nav-link">ê°“ì± ìƒµ</a>
                    </li>
                    <li class="nav-item">
                        <a href="community.html" class="nav-link">ì»¤ë®¤ë‹ˆí‹°</a>
                    </li>
                    <li class="nav-item">
                        <a href="media.html" class="nav-link">ë¯¸ë””ì–´</a>
                    </li>
                    <li class="nav-item">
                        <a href="customer-service.html" class="nav-link">ê³ ê°ì„¼í„°</a>
                    </li>
                </ul>
            </nav>

            <div class="auth-buttons">
                <!-- common-auth.jsì—ì„œ ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨ -->
            </div>

            <button class="mobile-menu-toggle" id="mobileToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main">
        <!-- ì¸ì¦ ì„¹ì…˜ -->
        <section class="auth-section">
            <div class="auth-container">
                <div class="auth-card">
                    <div class="auth-header">
                        <h1 class="auth-title">íšŒì›ê°€ì…</h1>
                        <p class="auth-subtitle">ê²Œì„ í¬í„¸ì˜ ìƒˆë¡œìš´ ëª¨í—˜ê°€ê°€ ë˜ì–´ë³´ì„¸ìš”</p>
                    </div>

                    <form class="auth-form" id="signupForm">
                        <div class="form-group">
                            <label class="form-label" for="userId">ì•„ì´ë””</label>
                            <div class="input-with-button">
                                <input 
                                    type="text" 
                                    id="userId" 
                                    name="userId"
                                    class="form-input" 
                                    placeholder="ì‚¬ìš©í•  ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                    required
                                >
                                <button type="button" class="check-btn" id="checkIdBtn">ì¤‘ë³µí™•ì¸</button>
                            </div>
                            <span class="form-error" id="userIdError"></span>
                            <span class="form-help">4-12ìì˜ ì˜ë¬¸, ìˆ«ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="nickname">ë‹‰ë„¤ì„</label>
                            <div class="input-with-button">
                                <input 
                                    type="text" 
                                    id="nickname" 
                                    name="nickname"
                                    class="form-input" 
                                    placeholder="ê²Œì„ì—ì„œ ì‚¬ìš©í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                    required
                                >
                                <button type="button" class="check-btn" id="checkNicknameBtn">ì¤‘ë³µí™•ì¸</button>
                            </div>
                            <span class="form-error" id="nicknameError"></span>
                            <span class="form-help">2-12ìì˜ í•œê¸€, ì˜ë¬¸, ìˆ«ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="email">ì´ë©”ì¼</label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email"
                                class="form-input" 
                                placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                required
                            >
                            <span class="form-error" id="emailError"></span>
                            <span class="form-help">ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©í•  ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="password">ë¹„ë°€ë²ˆí˜¸</label>
                            <div class="password-field">
                                <input 
                                    type="password" 
                                    id="password" 
                                    name="password"
                                    class="form-input" 
                                    placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                    required
                                >
                                <button type="button" class="password-toggle" id="passwordToggle">
                                    â—‰
                                </button>
                            </div>
                            <span class="form-error" id="passwordError"></span>
                            <div class="password-strength" id="passwordStrength">
                                <div class="strength-bar">
                                    <div class="strength-fill" id="strengthFill"></div>
                                </div>
                                <span class="strength-text" id="strengthText">ë¹„ë°€ë²ˆí˜¸ ê°•ë„</span>
                            </div>
                            <span class="form-help">8ì ì´ìƒ, ì˜ë¬¸/ìˆ«ì/íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì£¼ì„¸ìš”</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="confirmPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                            <div class="password-field">
                                <input 
                                    type="password" 
                                    id="confirmPassword" 
                                    name="confirmPassword"
                                    class="form-input" 
                                    placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”"
                                    required
                                >
                                <button type="button" class="password-toggle" id="confirmPasswordToggle">
                                    â—‰
                                </button>
                            </div>
                            <span class="form-error" id="confirmPasswordError"></span>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="birthDate">ìƒë…„ì›”ì¼</label>
                            <input 
                                type="date" 
                                id="birthDate" 
                                name="birthDate"
                                class="form-input" 
                                required
                            >
                            <span class="form-error" id="birthDateError"></span>
                            <span class="form-help">ë§Œ 14ì„¸ ì´ìƒë§Œ ê°€ì… ê°€ëŠ¥í•©ë‹ˆë‹¤</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">ì„±ë³„</label>
                            <div class="radio-group">
                                <label class="radio-container">
                                    <input type="radio" name="gender" value="male">
                                    <span class="radio-mark"></span>
                                    ë‚¨ì„±
                                </label>
                                <label class="radio-container">
                                    <input type="radio" name="gender" value="female">
                                    <span class="radio-mark"></span>
                                    ì—¬ì„±
                                </label>
                                <label class="radio-container">
                                    <input type="radio" name="gender" value="other">
                                    <span class="radio-mark"></span>
                                    ê¸°íƒ€
                                </label>
                            </div>
                        </div>

                        <div class="form-agreements">
                            <label class="checkbox-container">
                                <input type="checkbox" id="agreeAll">
                                <span class="checkmark"></span>
                                ì „ì²´ ë™ì˜
                            </label>
                            
                            <div class="agreement-list">
                                <label class="checkbox-container required">
                                    <input type="checkbox" id="agreeTerms" required>
                                    <span class="checkmark"></span>
                                    <span>ì´ìš©ì•½ê´€ ë™ì˜ <span class="required-mark">(í•„ìˆ˜)</span></span>
                                    <a href="#" class="agreement-link">ë‚´ìš©ë³´ê¸°</a>
                                </label>
                                
                                <label class="checkbox-container required">
                                    <input type="checkbox" id="agreePrivacy" required>
                                    <span class="checkmark"></span>
                                    <span>ê°œì¸ì •ë³´ ìˆ˜ì§‘/ì´ìš© ë™ì˜ <span class="required-mark">(í•„ìˆ˜)</span></span>
                                    <a href="#" class="agreement-link">ë‚´ìš©ë³´ê¸°</a>
                                </label>
                                
                                <label class="checkbox-container">
                                    <input type="checkbox" id="agreeMarketing">
                                    <span class="checkmark"></span>
                                    <span>ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜ (ì„ íƒ)</span>
                                    <a href="#" class="agreement-link">ë‚´ìš©ë³´ê¸°</a>
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="auth-submit-btn" id="signupBtn">
                            <span class="btn-text">íšŒì›ê°€ì…</span>
                            <div class="btn-loading" id="signupLoading">
                                <div class="loading-spinner"></div>
                            </div>
                        </button>

                        <div class="auth-switch">
                            <p>ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="login.html">ë¡œê·¸ì¸</a></p>
                        </div>
                    </form>
                </div>

                <!-- íšŒì›ê°€ì… í˜œíƒ ì„¹ì…˜ -->
                <div class="auth-benefits">
                    <h3>ì‹ ê·œ ê°€ì… í˜œíƒ</h3>
                    <div class="benefits-list">
                        <div class="benefit-item">
                            <div class="benefit-icon">ğŸ</div>
                            <div class="benefit-content">
                                <h4>ì‹ ê·œ ê°€ì… ë³´ìƒ</h4>
                                <p>ë‹¤ì´ì•„ëª¬ë“œ 1000ê°œ + ê³¨ë“œ 50000ê°œ</p>
                            </div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">â­</div>
                            <div class="benefit-content">
                                <h4>ì „ì„¤ê¸‰ ìºë¦­í„°</h4>
                                <p>ì‹ ê·œ ê°€ì…ì ì „ìš© ì „ì„¤ê¸‰ ìºë¦­í„° ì§€ê¸‰</p>
                            </div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">ğŸ›¡ï¸</div>
                            <div class="benefit-content">
                                <h4>7ì¼ ë¶€ìŠ¤í„°</h4>
                                <p>ê²½í—˜ì¹˜ +200%, ê³¨ë“œ íšë“ëŸ‰ +150%</p>
                            </div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">ğŸ®</div>
                            <div class="benefit-content">
                                <h4>VIP ì²´í—˜ê¶Œ</h4>
                                <p>3ì¼ê°„ VIP í˜œíƒì„ ë¬´ë£Œë¡œ ì²´í—˜</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>ê²Œì„ í¬í„¸</h4>
                    <p>ìµœê³ ì˜ ê²Œì„ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤</p>
                </div>
                <div class="footer-section">
                    <h4>ì§€ì›</h4>
                    <a href="#">FAQ</a>
                    <a href="customer-service.html">ê³ ê°ì„¼í„°</a>
                    <a href="#">ë²„ê·¸ ì‹ ê³ </a>
                </div>
                <div class="footer-section">
                    <h4>ì»¤ë®¤ë‹ˆí‹°</h4>
                    <a href="community.html">ê³µì‹ í¬ëŸ¼</a>
                    <a href="#">ë””ìŠ¤ì½”ë“œ</a>
                    <a href="#">ìœ íŠœë¸Œ</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Game Portal. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // ì¤‘ë³µì²´í¬ ìƒíƒœ ê´€ë¦¬
        let idChecked = false;
        let nicknameChecked = false;
        let isIdValid = false;
        let isNicknameValid = false;

        // ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€
        const mobileToggle = document.getElementById('mobileToggle');
        const navMenu = document.getElementById('navMenu');

        mobileToggle.addEventListener('click', function() {
            this.classList.toggle('active');
            navMenu.classList.toggle('active');
        });

        // ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°/ìˆ¨ê¸°ê¸°
        function setupPasswordToggle(toggleId, fieldId) {
            const toggle = document.getElementById(toggleId);
            const field = document.getElementById(fieldId);
            
            toggle.addEventListener('click', function() {
                const type = field.getAttribute('type') === 'password' ? 'text' : 'password';
                field.setAttribute('type', type);
                this.textContent = type === 'password' ? 'â—‰' : 'â—';
            });
        }

        setupPasswordToggle('passwordToggle', 'password');
        setupPasswordToggle('confirmPasswordToggle', 'confirmPassword');

        // ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜ë“¤
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validateNickname(nickname) {
            const re = /^[ê°€-í£a-zA-Z0-9]{2,12}$/;
            return re.test(nickname);
        }

        function validateUserId(userId) {
            const re = /^[a-zA-Z0-9]{4,12}$/;
            return re.test(userId);
        }

        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const monthDiff = today.getMonth() - birth.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }

        function showError(fieldId, message) {
            const errorElement = document.getElementById(fieldId + 'Error');
            const inputElement = document.getElementById(fieldId);
            if (errorElement && inputElement) {
                errorElement.textContent = message;
                errorElement.classList.remove('success');
                inputElement.classList.add('error');
                inputElement.classList.remove('success');
            }
        }

        function showSuccess(fieldId, message) {
            const errorElement = document.getElementById(fieldId + 'Error');
            const inputElement = document.getElementById(fieldId);
            if (errorElement && inputElement) {
                errorElement.textContent = message;
                errorElement.classList.add('success');
                inputElement.classList.remove('error');
                inputElement.classList.add('success');
            }
        }

        function clearError(fieldId) {
            const errorElement = document.getElementById(fieldId + 'Error');
            const inputElement = document.getElementById(fieldId);
            if (errorElement && inputElement) {
                errorElement.textContent = '';
                errorElement.classList.remove('success');
                inputElement.classList.remove('error');
                inputElement.classList.remove('success');
            }
        }

        // ì•„ì´ë”” ì¤‘ë³µì²´í¬
        document.getElementById('checkIdBtn').addEventListener('click', async function() {
            const userId = document.getElementById('userId').value.trim();
            
            if (!userId) {
                showError('userId', 'ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!validateUserId(userId)) {
                showError('userId', '4-12ìì˜ ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            this.disabled = true;
            this.textContent = 'í™•ì¸ì¤‘...';

            try {
                const response = await fetch('/api/check-id', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: userId })
                });

                const result = await response.json();

                if (result.available) {
                    showSuccess('userId', result.message);
                    idChecked = true;
                    isIdValid = true;
                } else {
                    showError('userId', result.message);
                    idChecked = false;
                    isIdValid = false;
                }
            } catch (error) {
                showError('userId', 'ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                idChecked = false;
                isIdValid = false;
            } finally {
                this.disabled = false;
                this.textContent = 'ì¤‘ë³µí™•ì¸';
            }
        });

        // ë‹‰ë„¤ì„ ì¤‘ë³µì²´í¬
        document.getElementById('checkNicknameBtn').addEventListener('click', async function() {
            const nickname = document.getElementById('nickname').value.trim();
            
            if (!nickname) {
                showError('nickname', 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!validateNickname(nickname)) {
                showError('nickname', '2-12ìì˜ í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            this.disabled = true;
            this.textContent = 'í™•ì¸ì¤‘...';

            try {
                const response = await fetch('/api/check-nickname', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ nickname: nickname })
                });

                const result = await response.json();

                if (result.available) {
                    showSuccess('nickname', result.message);
                    nicknameChecked = true;
                    isNicknameValid = true;
                } else {
                    showError('nickname', result.message);
                    nicknameChecked = false;
                    isNicknameValid = false;
                }
            } catch (error) {
                showError('nickname', 'ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                nicknameChecked = false;
                isNicknameValid = false;
            } finally {
                this.disabled = false;
                this.textContent = 'ì¤‘ë³µí™•ì¸';
            }
        });

        // ì…ë ¥ê°’ ë³€ê²½ì‹œ ì¤‘ë³µì²´í¬ ìƒíƒœ ì´ˆê¸°í™”
        document.getElementById('userId').addEventListener('input', function() {
            idChecked = false;
            isIdValid = false;
            clearError('userId');
        });

        document.getElementById('nickname').addEventListener('input', function() {
            nicknameChecked = false;
            isNicknameValid = false;
            clearError('nickname');
        });

        // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ì²´í¬
        const passwordField = document.getElementById('password');
        const strengthFill = document.getElementById('strengthFill');
        const strengthText = document.getElementById('strengthText');

        function checkPasswordStrength(password) {
            let strength = 0;
            const checks = {
                length: password.length >= 8,
                lower: /[a-z]/.test(password),
                upper: /[A-Z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[^A-Za-z0-9]/.test(password)
            };

            strength = Object.values(checks).filter(Boolean).length;
            
            const strengthLevels = ['ë§¤ìš° ì•½í•¨', 'ì•½í•¨', 'ë³´í†µ', 'ê°•í•¨', 'ë§¤ìš° ê°•í•¨'];
            const colors = ['#ff4757', '#ff6348', '#ffa502', '#2ed573', '#20bf6b'];
            
            strengthFill.style.width = (strength * 20) + '%';
            strengthFill.style.backgroundColor = colors[strength - 1] || '#ddd';
            strengthText.textContent = strengthLevels[strength - 1] || 'ë¹„ë°€ë²ˆí˜¸ ê°•ë„';
            
            return strength >= 3;
        }

        passwordField.addEventListener('input', function() {
            checkPasswordStrength(this.value);
        });

        // ì „ì²´ ë™ì˜ ì²´í¬ë°•ìŠ¤
        const agreeAll = document.getElementById('agreeAll');
        const individualCheckboxes = ['agreeTerms', 'agreePrivacy', 'agreeMarketing'];

        agreeAll.addEventListener('change', function() {
            individualCheckboxes.forEach(id => {
                document.getElementById(id).checked = this.checked;
            });
        });

        individualCheckboxes.forEach(id => {
            document.getElementById(id).addEventListener('change', function() {
                const allChecked = individualCheckboxes.every(checkId => 
                    document.getElementById(checkId).checked
                );
                agreeAll.checked = allChecked;
            });
        });

        // íšŒì›ê°€ì… í¼ ì œì¶œ
        const signupForm = document.getElementById('signupForm');
        const signupBtn = document.getElementById('signupBtn');
        const signupLoading = document.getElementById('signupLoading');

        signupForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // ëª¨ë“  ì—ëŸ¬ ì´ˆê¸°í™”
            ['userId', 'nickname', 'email', 'password', 'confirmPassword', 'birthDate'].forEach(clearError);

            const formData = {
                id: document.getElementById('userId').value.trim(),
                nickname: document.getElementById('nickname').value.trim(),
                email: document.getElementById('email').value.trim(),
                password: document.getElementById('password').value,
                confirmPassword: document.getElementById('confirmPassword').value,
                birthDate: document.getElementById('birthDate').value,
                gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                agreeTerms: document.getElementById('agreeTerms').checked,
                agreePrivacy: document.getElementById('agreePrivacy').checked,
                agreeMarketing: document.getElementById('agreeMarketing').checked
            };

            let isValid = true;

            // ì¤‘ë³µì²´í¬ í™•ì¸
            if (!idChecked || !isIdValid) {
                showError('userId', 'ì•„ì´ë”” ì¤‘ë³µí™•ì¸ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                isValid = false;
            }

            if (!nicknameChecked || !isNicknameValid) {
                showError('nickname', 'ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.');
                isValid = false;
            }

            // ì•„ì´ë”” ê²€ì‚¬
            if (!formData.id) {
                showError('userId', 'ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            } else if (!validateUserId(formData.id)) {
                showError('userId', '4-12ìì˜ ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                isValid = false;
            }

            // ë‹‰ë„¤ì„ ê²€ì‚¬
            if (!formData.nickname) {
                showError('nickname', 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            } else if (!validateNickname(formData.nickname)) {
                showError('nickname', '2-12ìì˜ í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                isValid = false;
            }

            // ì´ë©”ì¼ ê²€ì‚¬
            if (!formData.email) {
                showError('email', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            } else if (!validateEmail(formData.email)) {
                showError('email', 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                isValid = false;
            }

            // ë¹„ë°€ë²ˆí˜¸ ê²€ì‚¬
            if (!formData.password) {
                showError('password', 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            } else if (formData.password.length < 6) {
                showError('password', 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                isValid = false;
            }

            // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ê²€ì‚¬
            if (!formData.confirmPassword) {
                showError('confirmPassword', 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            } else if (formData.password !== formData.confirmPassword) {
                showError('confirmPassword', 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                isValid = false;
            }

            // ìƒë…„ì›”ì¼ ê²€ì‚¬
            if (formData.birthDate) {
                const age = calculateAge(formData.birthDate);
                if (age < 14) {
                    showError('birthDate', 'ë§Œ 14ì„¸ ì´ìƒë§Œ ê°€ì… ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    isValid = false;
                }
            }

            // í•„ìˆ˜ ì•½ê´€ ë™ì˜ ê²€ì‚¬
            if (!formData.agreeTerms) {
                alert('ì´ìš©ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
                isValid = false;
            }

            if (!formData.agreePrivacy) {
                alert('ê°œì¸ì •ë³´ ìˆ˜ì§‘/ì´ìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
                isValid = false;
            }

            if (!isValid) return;

            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            signupBtn.disabled = true;
            signupLoading.style.display = 'block';

            try {
                const response = await fetch('/api/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: formData.id,
                        nickname: formData.nickname,
                        email: formData.email,
                        password: formData.password,
                        birthDate: formData.birthDate,
                        gender: formData.gender
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nì‹ ê·œ ê°€ì… ë³´ìƒì´ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    window.location.href = '/login';
                } else {
                    // ì„œë²„ì—ì„œ ì˜¨ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                    if (result.error === 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤') {
                        showError('userId', result.error);
                        idChecked = false;
                        isIdValid = false;
                    } else if (result.error === 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤') {
                        showError('nickname', result.error);
                        nicknameChecked = false;
                        isNicknameValid = false;
                    } else {
                        alert(result.error || 'íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                }
            } catch (error) {
                console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
                alert('ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                // ë¡œë”© ìƒíƒœ í•´ì œ
                signupBtn.disabled = false;
                signupLoading.style.display = 'none';
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            // ì•½ê´€ ë§í¬ í´ë¦­
            document.querySelectorAll('.agreement-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('ì•½ê´€ ë‚´ìš©ì„ ë³´ì—¬ì£¼ëŠ” ëª¨ë‹¬ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.');
                });
            });

            // ìŠ¤í¬ë¡¤ íš¨ê³¼
            window.addEventListener('scroll', function() {
                const header = document.querySelector('.header');
                if (window.scrollY > 100) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });

            // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ì—ëŸ¬ ì œê±°
            ['userId', 'nickname', 'email', 'password', 'confirmPassword', 'birthDate'].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('focus', () => clearError(fieldId));
                }
            });
        });
    </script>
</body>
</html>